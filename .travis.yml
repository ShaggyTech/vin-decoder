language: node_js
node_js:
  - "13.12.0"
cache: yarn
before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
install:
  - yarn
jobs:
  include:
    # all branches
    - stage: Lint, Test, & Build
      script:
        - yarn lint
        - yarn test
        - yarn build
    # master branch only
      # Build and upload test coverage reports after every successful commit to master
    - stage: Master - upload test coverage to Codecov
      if: branch = master
      script:
        - npm install -g codecov
        - bash <(curl -s https://codecov.io/bash)
      # Deploy application to gh-pages branch after every successful commit to master
    - stage: Master - Deploy to Github Pages
      if: branch = master
      deploy:
          provider: pages
          skip-cleanup: true
          # Set in travis-ci.org dashboard, marked secure https://docs.travis-ci.com/user/deployment/pages/#Setting-the-GitHub-token
          github-token: $GH_TOKEN
          target-branch: gh-pages
          local-dir: dist
          on:
            branch: master